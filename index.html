<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë“œ ìƒë‹´ ìŠ¤ë§ˆíŠ¸ ê°€ì´ë“œ</title>
    <style>
        /* 1. ë””ìì¸ ë° ë ˆì´ì•„ì›ƒ */
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: #333; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* ìƒë‹¨ ê³µì§€ ë°” (ì œëª© í¬í•¨) */
        .top-info-bar { 
            background: #ffffff; border: 1px solid #dcdfe6;
            padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .notice-title {
            font-size: 1.1rem; font-weight: bold; color: #007bff;
            margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e7f1ff;
            display: flex; align-items: center;
        }

        /* ê³µì§€ ë¦¬ìŠ¤íŠ¸ (Aì—´/Bì—´ êµ¬ë¶„) */
        #notice-container { display: flex; flex-direction: column; min-height: 20px; }
        .notice-row { display: flex; align-items: flex-start; padding: 6px 0; border-bottom: 1px solid #f2f2f2; }
        .notice-row:last-child { border-bottom: none; }
        .col-date { width: 75px; font-weight: bold; color: #666; font-size: 0.95rem; flex-shrink: 0; }
        .col-content { flex: 1; color: #333; padding-left: 12px; font-weight: 500; }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë° ì¹´ë“œ */
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { flex: 1; padding: 14px; border: 1px solid #dcdfe6; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; color: #606266; font-size: 1rem; }
        .nav button.active { background: #007bff; color: white; border-color: #007bff; }

        .content { display: none; }
        .content.active { display: block; }
        .flex-row { display: flex; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; border: 1px solid #dcdfe6; flex: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }

        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dcdfe6; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-blue { background: #007bff; color: white; }
        .btn-blue:hover { background: #0056b3; }
        .btn-gray { background: #909399; color: white; }
        
        .result-box { background: #fdfdfd; padding: 15px; border-radius: 6px; border: 1px solid #ebeef5; margin-top: 15px; min-height: 120px; }
        
        /* ì‹¤ì  í†µê³„ */
        .summary { background: #f0f7ff; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; border: 1px solid #d0e3ff; }
        .summary-val { font-size: 2.2rem; font-weight: bold; color: #007bff; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f5f7fa; padding: 12px; border-bottom: 2px solid #ebeef5; }
        td { padding: 12px; border-bottom: 1px solid #ebeef5; text-align: center; }

        @media (max-width: 850px) { .flex-row { flex-direction: column; } }
    </style>
</head>
<body>

<div class="container">
    <div class="top-info-bar">
        <div class="notice-title">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
        <div id="notice-container">ê³µì§€ì‚¬í•­ ë°ì´í„°ë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div class="nav">
        <button id="btn-home" class="active" onclick="showTab('home')">ğŸ“œ ê°€ì´ë“œ & ë©˜íŠ¸</button>
        <button id="btn-perf" onclick="showTab('perf')">ğŸ“ˆ ì‹¤ì  í†µê³„</button>
    </div>

    <div id="home" class="content active">
        <div class="flex-row">
            <div class="card">
                <h3 style="margin-top:0;">ğŸ” ê°€ì´ë“œ ì¡°íšŒ</h3>
                <input type="text" id="quick-search" placeholder="í™”ë©´ë²ˆí˜¸ í˜¹ì€ í‚¤ì›Œë“œ ì…ë ¥">
                <button onclick="searchGuide()" class="btn btn-gray">ì¡°íšŒí•˜ê¸°</button>
                <div class="result-box">
                    <p><strong>ë²ˆí˜¸:</strong> <span id="view-screen">-</span></p>
                    <p><strong>ë‚´ìš©:</strong></p>
                    <div id="view-desc" style="white-space:pre-wrap;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
            </div>
            <div class="card">
                <h3 style="margin-top:0; color:#007bff;">âœï¸ ë©˜íŠ¸ ìƒì„±</h3>
                <select id="ment-type"><option value="">ë¡œë”© ì¤‘...</option></select>
                <button onclick="generateMent()" class="btn btn-blue">ë©˜íŠ¸ ìƒì„±</button>
                <textarea id="ment-output" rows="13" style="margin-top:10px;" placeholder="ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
            </div>
        </div>
    </div>

    <div id="perf" class="content">
        <div class="card" style="max-width: 650px; margin: 0 auto;">
            <h3 style="margin-top:0;">ğŸ“Š ì›”ê°„ ì‹¤ì  í˜„í™©</h3>
            <div class="summary">
                <div style="font-size: 0.95rem; color: #666; margin-bottom: 5px;">ì´ë²ˆ ë‹¬ ëˆ„ì  ì™„ë£Œ ê±´ìˆ˜</div>
                <div class="summary-val"><span id="total-calls">0</span>ê±´</div>
            </div>
            <table>
                <thead><tr><th>ë‚ ì§œ</th><th>ì½œìˆ˜</th><th>ë‹¬ì„±ë¥ </th></tr></thead>
                <tbody id="perf-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 2. í†µí•© ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„
    const API_URL = "https://script.google.com/macros/s/AKfycbxn9dNC9NvG-cwkwxOBfEVAM8vYKYUrqLX-MvF9OqIr7AHGZEDBml5mqjPftgVFFYK29w/exec";
    let mentCache = [];

    // ì‹¤í–‰ ì‹œì‘ì 
    async function startApp() {
        console.log("ì•± ì‹œì‘...");
        await Promise.all([loadNotice(), loadMentData(), loadPerfData()]);
    }

    // ê³µì§€ì‚¬í•­ ë¡œë“œ (Aì—´/Bì—´ ë¶„ë¦¬)
    async function loadNotice() {
        try {
            const r = await fetch(`${API_URL}?mode=notice`);
            const data = await r.json();
            const box = document.getElementById("notice-container");
            box.innerHTML = "";
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = document.createElement("div");
                    row.className = "notice-row";
                    row.innerHTML = `<div class="col-date">${item.date || ""}</div><div class="col-content">â€¢ ${item.content || ""}</div>`;
                    box.appendChild(row);
                });
            } else { box.innerHTML = "ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."; }
        } catch (e) { console.error("ê³µì§€ ë¡œë“œ ì‹¤íŒ¨:", e); }
    }

    // ë©˜íŠ¸ ë° ê°€ì´ë“œ ë°ì´í„°
    async function loadMentData() {
        try {
            const r = await fetch(`${API_URL}?mode=ment`);
            mentCache = await r.json();
            const select = document.getElementById("ment-type");
            const types = [...new Set(mentCache.map(i => i.type).filter(t => t))];
            select.innerHTML = '<option value="">ìƒí™© ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            types.forEach(t => select.innerHTML += `<option value="${t}">${t}</option>`);
        } catch (e) { console.error("ë©˜íŠ¸ ë¡œë“œ ì‹¤íŒ¨:", e); }
    }

    // ê°€ì´ë“œ ê²€ìƒ‰
    function searchGuide() {
        const val = document.getElementById("quick-search").value.trim().toLowerCase();
        if(!val) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        const f = mentCache.find(i => String(i.screenNum).toLowerCase() === val || String(i.keywords).includes(val));
        if(f) {
            document.getElementById("view-screen").innerText = f.screenNum;
            document.getElementById("view-desc").innerText = f.description;
        } else { alert("ì°¾ìœ¼ì‹œëŠ” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."); }
    }

    // ë©˜íŠ¸ ìƒì„±
    function generateMent() {
        const sel = document.getElementById("ment-type").value;
        if(!sel) return alert("ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.");
        const res = mentCache.filter(i => i.type === sel);
        document.getElementById("ment-output").value = res.map((i, idx) => `[ë©˜íŠ¸ ${idx+1}]\n${i.text}`).join("\n\n------------------\n\n");
    }

    // ì‹¤ì  ë°ì´í„°
    async function loadPerfData() {
        try {
            const r = await fetch(`${API_URL}?mode=perf`);
            const data = await r.json();
            const list = document.getElementById("perf-list");
            let total = 0;
            list.innerHTML = "";
            data.forEach(row => {
                total += parseInt(String(row.current).replace(/[^0-9]/g, "")) || 0;
                const dateText = row.date.includes('T') ? row.date.split('T')[0] : row.date;
                list.innerHTML += `<tr><td>${dateText}</td><td>${row.current}ì½œ</td><td>${row.rate}</td></tr>`;
            });
            document.getElementById("total-calls").innerText = total.toLocaleString();
        } catch (e) { console.error("ì‹¤ì  ë¡œë“œ ì‹¤íŒ¨:", e); }
    }

    // íƒ­ ì „í™˜ ì‹œìŠ¤í…œ
    function showTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('btn-' + id).classList.add('active');
    }

    // ì•± ì‹¤í–‰ íŠ¸ë¦¬ê±° (ë¸Œë¼ìš°ì € ë¡œë“œ ì‹œ ì‹¤í–‰)
    window.addEventListener('DOMContentLoaded', startApp);
</script>
</body>
</html>
