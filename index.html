<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ìƒë‹´ ê°€ì´ë“œ</title>
    <style>
        :root { --blue: #3b82f6; --red: #ef4444; --bg: #f8fafc; --yellow: #fffdf2; --border: #e2e8f0; }
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background: var(--bg); margin: 0; padding: 12px; height: 100vh; display: flex; flex-direction: column; overflow: hidden; color: #1e293b; }
        
        /* âœ… ê³µì§€ì‚¬í•­: ì€ì€í•œ ë…¸ë€ìƒ‰ê³¼ ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        .notice-container { 
            background: var(--yellow); border: 1px solid #fde68a; 
            border-radius: 16px; height: 100px; padding: 12px 16px; margin-bottom: 12px; 
            flex-shrink: 0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); display: flex; flex-direction: column;
        }
        .notice-header { font-weight: 700; font-size: 1rem; color: #b45309; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
        .notice-list { overflow-y: auto; flex-grow: 1; font-size: 0.9rem; line-height: 1.5; }
        .notice-item { border-bottom: 1px solid #fef3c7; padding: 4px 0; display: flex; gap: 10px; }
        .notice-date { color: #d97706; font-weight: 600; min-width: 55px; }

        /* âœ… ë©”ì¸ ë ˆì´ì•„ì›ƒ: ì—¬ë°±ê³¼ ê°„ê²© ìµœì í™” */
        .main-layout { display: flex; gap: 16px; flex: 1; overflow: hidden; }
        
        /* âœ… íŒ¨ë„: ì´ŒìŠ¤ëŸ¬ìš´ êµµì€ ì„  ëŒ€ì‹  ì–‡ì€ ê²½ê³„ì„ ê³¼ ê¹Šì´ê° ìˆëŠ” ê·¸ë¦¼ì */
        .panel { 
            background: white; border-radius: 20px; padding: 20px; 
            border: 1px solid var(--border); 
            display: flex; flex-direction: column; flex: 1; min-width: 0; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.04);
        }

        /* í¬ì¸íŠ¸ ì»¬ëŸ¬ ë°”: ìƒë‹¨ì—ë§Œ ì–‡ê²Œ ë°°ì¹˜í•˜ì—¬ ì„¸ë ¨ë¯¸ ê°•ì¡° */
        .panel-blue { border-top: 4px solid var(--blue); }
        .panel-red { border-top: 4px solid var(--red); }

        h2 { font-size: 1.1rem; font-weight: 700; margin: 0 0 16px 0; color: #0f172a; display: flex; align-items: center; gap: 8px; }
        
        /* âœ… ì…ë ¥ì°½: ë‘¥ê¸€ê³  ê¹¨ë—í•œ ë””ìì¸ */
        select, input { 
            width: 100%; padding: 12px; border-radius: 12px; 
            border: 1.5px solid #e2e8f0; font-size: 1rem; background: #fcfdfe;
            transition: all 0.2s ease; box-sizing: border-box; 
        }
        select:focus, input:focus { border-color: var(--blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); outline: none; }
        
        /* âœ… ë©˜íŠ¸ ë°•ìŠ¤: ë„“ê³  ì¾Œì í•œ ê°€ë…ì„± */
        .ment-box { 
            background: #f1f5f9; border-radius: 14px; padding: 18px; 
            flex: 1; font-size: 1.05rem; line-height: 1.7; overflow-y: auto; 
            margin-top: 12px; white-space: pre-wrap; color: #334155; border: 1px solid #f1f5f9;
        }

        /* âœ… ê°€ì´ë“œ ë°•ìŠ¤: ë¶€ë“œëŸ¬ìš´ í•‘í¬í†¤ */
        .guide-box { 
            background: #fff1f2; border-radius: 12px; padding: 14px; 
            height: 80px; overflow-y: auto; margin: 10px 0; 
            font-size: 0.95rem; border-left: 4px solid var(--red);
        }
        
        /* âœ… ì‹¤ì  í…Œì´ë¸”: ê¹”ë”í•œ ë¼ì¸ ë””ìì¸ */
        .perf-area { flex: 1; overflow-y: auto; border: 1px solid #f1f5f9; border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; position: sticky; top: 0; padding: 10px; font-size: 0.85rem; color: #64748b; border-bottom: 1px solid #e2e8f0; text-align: center; }
        td { padding: 10px; border-bottom: 1px solid #f1f5f9; text-align: center; font-size: 0.9rem; }
        .cum-cell { font-weight: 700; color: var(--blue); }

        /* âœ… ìŒì„± ë²„íŠ¼: ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ */
        .voice-btn { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
            color: white; border: none; padding: 14px; border-radius: 14px; 
            font-weight: 600; font-size: 1rem; cursor: pointer; margin-top: 12px;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2); transition: transform 0.1s;
        }
        .voice-btn:active { transform: scale(0.97); }
    </style>
</head>
<body>

<div class="notice-container">
    <div class="notice-header">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
    <div id="notice-list" class="notice-list">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div class="main-layout">
    <div class="panel panel-blue">
        <h2>ğŸ“ ìƒë‹´ ë©˜íŠ¸</h2>
        <select id="ment-select" onchange="updateMentBox(this.value)">
            <option value="">ìƒí™© ì„ íƒ</option>
        </select>
        <div id="ment-display" class="ment-box">ìƒí™©ì„ ì„ íƒí•˜ë©´ ìµœì ì˜ ë©˜íŠ¸ê°€ ë¡œë“œë©ë‹ˆë‹¤.</div>
    </div>

    <div class="panel panel-red">
        <h2>ğŸ“Š ì‹¤ì  ë° ê°€ì´ë“œ</h2>
        <input type="text" id="keyword" placeholder="í™”ë©´ë²ˆí˜¸/í‚¤ì›Œë“œ ê²€ìƒ‰..." onkeyup="searchGuide()">
        <div id="guide-display" class="guide-box">ê°€ì´ë“œ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        
        <div class="perf-area">
            <table>
                <thead><tr><th>ë‚ ì§œ</th><th>ì™„ë£Œ</th><th>ëˆ„ì </th></tr></thead>
                <tbody id="perf-list"></tbody>
            </table>
        </div>
        <button class="voice-btn" onclick="startVoice()">ğŸ™ï¸ ì‹¤ì  ìŒì„± ê¸°ë¡</button>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxTpgRKDGBMrq4IAEozIVSR1gtMdlFwOPosubxZUXG4BaYTYFVgk68lZPjF9dqOzRfEbA/exec";
    let db = { notice: [], ment: [], perf: [] };

    async function loadData() {
        try {
            const res = await fetch(`${API_URL}?t=${Date.now()}`).then(r => r.json());
            db = res;
            document.getElementById('notice-list').innerHTML = res.notice.map(n => 
                `<div class="notice-item"><span class="notice-date">${n.date}</span><span>${n.content}</span></div>`).join('');
            const select = document.getElementById('ment-select');
            select.innerHTML = '<option value="">ìƒí™© ì„ íƒ</option>';
            res.ment.filter(m => m.type).forEach(m => {
                const opt = document.createElement('option');
                opt.value = m.type; opt.innerText = m.type; select.appendChild(opt);
            });
            let cum = 0;
            document.getElementById('perf-list').innerHTML = res.perf.map(p => {
                const val = parseInt(String(p.val).replace(/[^0-9]/g, '')) || 0;
                cum += val;
                return `<tr><td>${p.date}</td><td>${p.val}</td><td class="cum-cell">${cum.toLocaleString()}</td></tr>`;
            }).join('');
        } catch(e) { document.getElementById('notice-list').innerText = "âš ï¸ ì—°ê²° ì˜¤ë¥˜"; }
    }

    function updateMentBox(v) {
        const item = db.ment.find(m => m.type === v);
        document.getElementById('ment-display').innerText = item ? item.talk : "ìƒí™©ì„ ì„ íƒí•˜ë©´ ìµœì ì˜ ë©˜íŠ¸ê°€ ë¡œë“œë©ë‹ˆë‹¤.";
    }

    function searchGuide() {
        const q = document.getElementById('keyword').value.toLowerCase().trim();
        const found = db.ment.find(m => String(m.num).includes(q) || (m.key && m.key.toLowerCase().includes(q)));
        document.getElementById('guide-display').innerHTML = found ? `<b>${found.key}</b><br>${found.pos}` : "ê°€ì´ë“œ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.";
    }

    function startVoice() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!Speech) return alert("ë¯¸ì§€ì› ë¸Œë¼ìš°ì €");
        const rec = new Speech(); rec.lang = 'ko-KR'; rec.start();
        document.getElementById('notice-list').innerText = "ğŸ¤ ìŒì„± ì¸ì‹ ì¤‘...";
        rec.onresult = (e) => {
            const val = e.results[0][0].transcript.replace(/[^0-9]/g, '');
            if(val && confirm(`${val}ê±´ ì €ì¥í• ê¹Œìš”?`)) alert("ì €ì¥ ìš”ì²­ë¨");
            loadData();
        };
    }
    window.onload = loadData;
</script>
</body>
</html>
