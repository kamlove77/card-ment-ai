<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ë“œ ìƒë‹´ ìŠ¤ë§ˆíŠ¸ ê°€ì´ë“œ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* ê³µì§€ì‚¬í•­ ì„¹ì…˜ (ìŠ¤í¬ë¡¤ ê³ ì •) */
        .top-info-bar { background: #ffffff; border: 1px solid #dcdfe6; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .notice-title { font-size: 1.1rem; font-weight: bold; color: #007bff; margin-bottom: 12px; border-bottom: 2px solid #e7f1ff; padding-bottom: 8px; }
        #notice-container { max-height: 150px; overflow-y: auto; padding-right: 5px; min-height: 50px; }
        #notice-container::-webkit-scrollbar { width: 6px; }
        #notice-container::-webkit-scrollbar-thumb { background: #dcdfe6; border-radius: 10px; }
        .notice-row { display: flex; padding: 8px 0; border-bottom: 1px solid #f2f2f2; align-items: flex-start; }
        .col-date { width: 80px; font-weight: bold; color: #888; flex-shrink: 0; font-size: 0.9rem; }
        .col-content { flex: 1; padding-left: 10px; word-break: break-all; font-size: 0.95rem; line-height: 1.4; }

        /* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ */
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { flex: 1; padding: 15px; border: 1px solid #dcdfe6; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; font-size: 1rem; color: #606266; }
        .nav button.active { background: #007bff !important; color: white !important; }

        /* ì½˜í…ì¸  ì˜ì—­ */
        .content { display: none; }
        .content.active { display: block; }
        .flex-row { display: flex; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; border: 1px solid #dcdfe6; flex: 1; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dcdfe6; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn-blue { background: #007bff; color: white; }
        .btn-gray { background: #909399; color: white; }
        
        .summary { background: #f0f7ff; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; border: 1px solid #d0e3ff; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #ebeef5; text-align: center; }
        th { background: #f8f9fa; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-info-bar">
        <div class="notice-title">ğŸ“¢ ì‹¤ì‹œê°„ ê³µì§€ì‚¬í•­</div>
        <div id="notice-container">ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
    </div>

    <div class="nav">
        <button id="tab-home" class="active" onclick="goTab('home')">ğŸ“œ ê°€ì´ë“œ & ë©˜íŠ¸</button>
        <button id="tab-perf" onclick="goTab('perf')">ğŸ“ˆ ì‹¤ì  í†µê³„</button>
    </div>

    <div id="sec-home" class="content active">
        <div class="flex-row">
            <div class="card">
                <h3>ğŸ” ê°€ì´ë“œ ì¡°íšŒ</h3>
                <input type="text" id="in-search" placeholder="í™”ë©´ë²ˆí˜¸ í˜¹ì€ í‚¤ì›Œë“œ ì…ë ¥">
                <button onclick="fnSearch()" class="btn btn-gray">ì¡°íšŒí•˜ê¸°</button>
                <div style="margin-top:15px; background:#f9f9f9; padding:15px; border-radius:6px; min-height:110px; border:1px solid #eee;">
                    <p><strong>í™”ë©´ë²ˆí˜¸:</strong> <span id="out-num" style="color:#007bff;">-</span></p>
                    <strong>ë‚´ìš©:</strong>
                    <div id="out-desc" style="white-space:pre-wrap; margin-top:5px; font-size:0.95rem;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
            </div>
            <div class="card">
                <h3 style="color:#007bff;">âœï¸ ë©˜íŠ¸ ìƒì„±</h3>
                <select id="sel-type"><option value="">ë¡œë”© ì¤‘...</option></select>
                <button onclick="fnMent()" class="btn btn-blue">ë©˜íŠ¸ ìƒì„±</button>
                <textarea id="out-ment" rows="12" style="margin-top:10px;"></textarea>
            </div>
        </div>
    </div>

    <div id="sec-perf" class="content">
        <div class="card" style="max-width: 600px; margin: 0 auto;">
            <h3>ğŸ“Š ì›”ê°„ ì‹¤ì  í˜„í™©</h3>
            <div class="summary">ì´ë²ˆ ë‹¬ ëˆ„ì  ì™„ë£Œ: <span id="txt-total" style="font-size:26px; font-weight:bold; color:#007bff;">0</span>ê±´</div>
            <table>
                <thead><tr><th>ë‚ ì§œ</th><th>ì½œìˆ˜</th><th>ë‹¬ì„±ë¥ </th></tr></thead>
                <tbody id="list-perf"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbxTpgRKDGBMrq4IAEozIVSR1gtMdlFwOPosubxZUXG4BaYTYFVgk68lZPjF9dqOzRfEbA/exec";
    let allData = [];

    function goTab(mode) {
        document.getElementById('sec-home').style.display = (mode === 'home') ? 'block' : 'none';
        document.getElementById('sec-perf').style.display = (mode === 'perf') ? 'block' : 'none';
        document.getElementById('tab-home').className = (mode === 'home') ? 'active' : '';
        document.getElementById('tab-perf').className = (mode === 'perf') ? 'active' : '';
    }

    // ë”ìš± ê°•ë ¥í•´ì§„ ë‚ ì§œ ë³€í™˜ê¸° (ì–´ë–¤ ì˜¤íƒ€ê°€ ì™€ë„ ë©ˆì¶”ì§€ ì•ŠìŒ)
    function fixDate(v) {
        if (!v) return "-";
        try {
            const d = new Date(v);
            if(!isNaN(d.getTime())) {
                return (d.getMonth() + 1).toString().padStart(2, '0') + "-" + d.getDate().toString().padStart(2, '0');
            }
            return String(v).split('T')[0]; // ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹ˆë©´ ë¬¸ìì—´ ê·¸ëŒ€ë¡œë¼ë„ ì¶œë ¥
        } catch (e) { return String(v); }
    }

    async function loadAll() {
        const timestamp = new Date().getTime();
        try {
            // 1. ê³µì§€ì‚¬í•­ ë¡œë“œ
            const r1 = await fetch(`${API}?mode=notice&t=${timestamp}`);
            const d1 = await r1.json();
            const b1 = document.getElementById("notice-container");
            b1.innerHTML = d1.length ? "" : "ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.";
            d1.forEach(i => {
                if(i.content) b1.innerHTML += `<div class="notice-row"><div class="col-date">${i.date || ''}</div><div class="col-content">${i.content}</div></div>`;
            });

            // 2. ê°€ì´ë“œ/ë©˜íŠ¸ ë¡œë“œ
            const r2 = await fetch(`${API}?mode=ment&t=${timestamp}`);
            allData = await r2.json();
            const sel = document.getElementById("sel-type");
            const ts = [...new Set(allData.map(i => i.type).filter(t => t))];
            sel.innerHTML = '<option value="">ìƒí™© ì„ íƒ</option>';
            ts.forEach(t => sel.innerHTML += `<option value="${t}">${t}</option>`);

            // 3. ì‹¤ì  ë¡œë“œ
            const r3 = await fetch(`${API}?mode=perf&t=${timestamp}`);
            const d3 = await r3.json();
            const b3 = document.getElementById("list-perf");
            let total = 0;
            b3.innerHTML = "";
            d3.forEach(r => {
                if(r.date) {
                    const colCount = parseInt(String(r.current).replace(/[^0-9]/g, "")) || 0;
                    total += colCount;
                    b3.innerHTML += `<tr><td>${fixDate(r.date)}</td><td>${r.current || 0}ì½œ</td><td>${r.rate || '0%'}</td></tr>`;
                }
            });
            document.getElementById("txt-total").innerText = total.toLocaleString();

        } catch (e) {
            console.error("ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
            document.getElementById("notice-container").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì‹œíŠ¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
        }
    }

    function fnSearch() {
        const v = document.getElementById("in-search").value.trim().toLowerCase();
        if(!v) return;
        const f = allData.find(i => String(i.screenNum).toLowerCase() === v || (i.keywords && i.keywords.includes(v)));
        if(f) {
            document.getElementById("out-num").innerText = f.screenNum;
            document.getElementById("out-desc").innerText = f.description;
        } else { alert("ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."); }
    }

    function fnMent() {
        const s = document.getElementById("sel-type").value;
        if(!s) return alert("ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.");
        const res = allData.filter(i => i.type === s);
        document.getElementById("out-ment").value = res.map((i, idx) => `[ë©˜íŠ¸ ${idx+1}]\n${i.text}`).join("\n\n---\n\n");
    }

    window.onload = loadAll;
</script>
</body>
</html>
