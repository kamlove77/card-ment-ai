<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ë“œ ìƒë‹´ ìŠ¤ë§ˆíŠ¸ ê°€ì´ë“œ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        .top-info-bar { background: #ffffff; border: 1px solid #dcdfe6; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .notice-title { font-size: 1.1rem; font-weight: bold; color: #007bff; margin-bottom: 12px; border-bottom: 2px solid #e7f1ff; padding-bottom: 8px; }
        .notice-row { display: flex; padding: 6px 0; border-bottom: 1px solid #f2f2f2; }
        .col-date { width: 80px; font-weight: bold; color: #666; }
        .col-content { flex: 1; padding-left: 10px; }
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { flex: 1; padding: 15px; border: 1px solid #dcdfe6; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; font-size: 1rem; color: #606266; }
        .nav button.active { background: #007bff !important; color: white !important; border-color: #007bff !important; }
        .content { display: none; }
        .content.active { display: block; }
        .flex-row { display: flex; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; border: 1px solid #dcdfe6; flex: 1; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dcdfe6; border-radius: 6px; box-sizing: border-box; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-blue { background: #007bff; color: white; }
        .btn-gray { background: #909399; color: white; }
        .summary { background: #f0f7ff; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #ebeef5; text-align: center; }
        th { background: #f8f9fa; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-info-bar">
        <div class="notice-title">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
        <div id="notice-container">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div class="nav">
        <button id="tab-home" class="active" onclick="changeTab('home')">ğŸ“œ ê°€ì´ë“œ & ë©˜íŠ¸</button>
        <button id="tab-perf" onclick="changeTab('perf')">ğŸ“ˆ ì‹¤ì  í†µê³„</button>
    </div>

    <div id="home-sec" class="content active">
        <div class="flex-row">
            <div class="card">
                <h3>ğŸ” ê°€ì´ë“œ ì¡°íšŒ</h3>
                <input type="text" id="search-input" placeholder="í™”ë©´ë²ˆí˜¸ í˜¹ì€ í‚¤ì›Œë“œ ì…ë ¥">
                <button onclick="doSearch()" class="btn btn-gray">ì¡°íšŒí•˜ê¸°</button>
                <div style="margin-top:15px; background:#f9f9f9; padding:15px; border-radius:6px; min-height:100px;">
                    <strong>ë²ˆí˜¸:</strong> <span id="res-num">-</span><br><br>
                    <strong>ë‚´ìš©:</strong><div id="res-desc" style="white-space:pre-wrap;">-</div>
                </div>
            </div>
            <div class="card">
                <h3 style="color:#007bff;">âœï¸ ë©˜íŠ¸ ìƒì„±</h3>
                <select id="ment-sel"><option>ë¡œë”© ì¤‘...</option></select>
                <button onclick="doMent()" class="btn btn-blue">ë©˜íŠ¸ ìƒì„±</button>
                <textarea id="ment-txt" rows="12" style="margin-top:10px;"></textarea>
            </div>
        </div>
    </div>

    <div id="perf-sec" class="content">
        <div class="card" style="max-width: 600px; margin: 0 auto;">
            <h3>ğŸ“Š ì›”ê°„ ì‹¤ì  í˜„í™©</h3>
            <div class="summary">ì´ë²ˆ ë‹¬ ì´ ì™„ë£Œ: <span id="all-total" style="font-size:24px; font-weight:bold; color:#007bff;">0</span>ê±´</div>
            <table>
                <thead><tr><th>ë‚ ì§œ</th><th>ì½œìˆ˜</th><th>ë‹¬ì„±ë¥ </th></tr></thead>
                <tbody id="p-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 1. êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URL (ê¸°ì¡´ URL ìœ ì§€)
    const URL = "https://script.google.com/macros/s/AKfycbxn9dNC9NvG-cwkwxOBfEVAM8vYKYUrqLX-MvF9OqIr7AHGZEDBml5mqjPftgVFFYK29w/exec";
    let dataList = [];

    // 2. íƒ­ ì „í™˜ ê¸°ëŠ¥ (ê°€ì¥ í™•ì‹¤í•œ ë°©ì‹)
    function changeTab(mode) {
        const homeSec = document.getElementById('home-sec');
        const perfSec = document.getElementById('perf-sec');
        const btnHome = document.getElementById('tab-home');
        const btnPerf = document.getElementById('tab-perf');

        if (mode === 'home') {
            homeSec.style.display = 'block';
            perfSec.style.display = 'none';
            btnHome.classList.add('active');
            btnPerf.classList.remove('active');
        } else {
            homeSec.style.display = 'none';
            perfSec.style.display = 'block';
            btnHome.classList.remove('active');
            btnPerf.classList.add('active');
        }
    }

    // 3. ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜ (ì˜ë¬¸ ë‚ ì§œ í•´ê²°)
    function formatDate(input) {
        try {
            const d = new Date(input);
            if (!isNaN(d.getTime())) {
                const m = (d.getMonth() + 1).toString().padStart(2, '0');
                const dd = d.getDate().toString().padStart(2, '0');
                return `${m}-${dd}`;
            }
            return input;
        } catch (e) { return input; }
    }

    // 4. ë°ì´í„° í†µí•© ë¡œë“œ
    async function loadAll() {
        try {
            // ê³µì§€ì‚¬í•­
            const nRes = await fetch(URL + "?mode=notice");
            const nData = await nRes.json();
            const nBox = document.getElementById("notice-container");
            nBox.innerHTML = "";
            nData.forEach(i => {
                nBox.innerHTML += `<div class="notice-row"><div class="col-date">${i.date}</div><div class="col-content">â€¢ ${i.content}</div></div>`;
            });

            // ê°€ì´ë“œ/ë©˜íŠ¸
            const mRes = await fetch(URL + "?mode=ment");
            dataList = await mRes.json();
            const sel = document.getElementById("ment-sel");
            const types = [...new Set(dataList.map(i => i.type).filter(t => t))];
            sel.innerHTML = '<option value="">ìƒí™© ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            types.forEach(t => sel.innerHTML += `<option value="${t
